<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use app\components\annex\ActiveForm;
use app\components\annex\Modal;
use dmstr\helpers\Html;
use yii\helpers\Url;
use yii\grid\GridView;
use yii\widgets\DetailView;
use yii\widgets\Pjax;
use app\components\annex\Tabs;
use richardfan\widget\JSRegister;

/**
 * @var yii\web\View $this
 * @var app\models\Proyek $model
 */
// $this->title = 'Proyek : ' . $model->label;
$this->registerCssFile("@web/homepage/css/sweetalert2.min.css");
$this->registerCss("

.overlay {
    position:absolute;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.4);
}
");
$setting = \app\models\SiteSetting::find()->all();
?>
<!-- Navigation -->
<section class="navigation">
    <div class="parallax parallax--nav" style="background-image: url(<?= \Yii::$app->request->baseUrl . "/uploads/" . $setting[0]['gambar_header'] ?>);">
        <div class="overlay"></div>
        <div class="container clearfix">
            <div class="row">
                <div class="col-12">
                    <h2>
                        <?= $setting[0]['tagline']; ?>
                    </h2>
                </div>
                <div class="col-12">
                    <p>
                        <?= $setting[0]['tagline2']; ?>
                    </p>
                </div>
                <div class="col-12">
                    <ul class="breadcrumbs ul--inline ul--no-style">
                        <li>
                            <a href="<?= \Yii::$app->request->BaseUrl ?>/home">Home</a>
                        </li>
                        <span>/</span>
                        <li class="active">
                            <a href="<?= \Yii::$app->request->BaseUrl ?>/home/cari-tukang/index">Cari Tukang</a>
                        </li>
                        <span>/</span>
                        <li class="active">
                            <a href="#">Detail</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Navigation -->
<!-- Contact content -->
<section class="contact-content">
    <div class="container">
        <div class="col-md-12">
            <h2 class="title title-3 title--dark">
                Detail Keperluan Layanan
            </h2>
        </div>
        <div class="col-lg-12 col-12 layout-spacing">
            <?php if ($model->status == \app\models\PekerjaanSameday::STATUS_PELENGKAPAN_DATA) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Anda baru saja melengkapi data. Mohon tunggu konfirmasi Admin.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_SURVEY_LOKASI) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Admin telah menambahkan tanggal survey lokasi. Mohon tunggu penentuan layanan dari Admin.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->bukti_dp == null && $model->catatan_revisi == null) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Admin telah menentukan layanan Anda. Selanjutnya mohon membayar DP yang telah ditentukan atau merevisi layanan yang diberikan Admin.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->bukti_dp == null && $model->catatan_revisi != null) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Admin telah menerima revisi layanan tukang Anda. Mohon tunggu konfirmasi dari Admin.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <?php elseif ($model->bukti_dp != null && $model->nominal_dp != null) :
                if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->revisi_pembayaran_dp == null) :
                ?>
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        <strong>Hai <?= $model->pelanggan->username ?></strong>, Anda telah membayar DP. Mohon tunggu konfirmasi Admin.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->revisi_pembayaran_dp != null) : ?>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Hai <?= $model->pelanggan->username ?></strong>, pembayaran Anda perlu direvisi. Mohon upload ulang bukti DP.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                <?php endif ?>
            <?php endif ?>
            <?php if ($model->status == \app\models\PekerjaanSameday::STATUS_PENGERJAAN) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Admin telah mengkonfirmasi DP Anda. Mohon tunggu pengajuan pekerjaan dari tukang.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php endif ?>
            <?php if ($model->status == \app\models\PekerjaanSameday::STATUS_DIAJUKAN && $model->catatan_revisi == null) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Tukang telah mengajukan pekerjaan. Mohon cek pekerjaan, jika membutuhkan revisi klik tombol revisi, jika tidak ada revisi bisa langsung membayar biaya akhir.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_DIAJUKAN && $model->catatan_revisi != null) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Tukang telah menerima catatan revisi. Mohon tunggu penyelesaian pekerjaan dari tukang.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php endif ?>
            <?php if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN && $model->revisi_pembayaran == null) : ?>
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, Anda telah melakukan pembayaran akhir. Mohon tunggu konfirmasi admin.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN && $model->revisi_pembayaran != null) : ?>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, pembayaran Anda perlu direvisi. Mohon upload ulang bukti pembayaran akhir.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_SELESAI) : ?>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, pembayaran Anda telah dikonfirmasi. Pekerjaan selesai.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP_EXPIRED) : ?>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <strong>Hai <?= $model->pelanggan->username ?></strong>, pembayaran Anda telah kadaluarsa. Mohon ulangi order kembali.
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <?php endif ?>
            <div class="row">
                <div class="col-md-6 col-sm-12">
                    <h4>Data Pelanggan</h4>
                    <div class="card m-b-30">
                        <div class="">
                            <table class="table table-responsive table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Pengguna</th>
                                        <td><?= $model->pelanggan->name ?></td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th>Nama Pelanggan</th>
                                        <td><?= $model->nama_pelanggan ?></td>
                                    </tr>
                                    <tr>
                                        <th>Alamat</th>
                                        <td><?= $model->alamat_pelanggan ?></td>
                                    </tr>
                                    <tr>
                                        <th>Tanggal Survey</th>
                                        <td><?= \app\components\Tanggal::toReadableDate($model->tanggal_survey) ?></td>
                                    </tr>
                                    <tr>
                                        <th>Status</th>
                                        <td><?= $model->getStatus() ?></td>
                                    </tr>
                                    <!-- <tr>
                                        <th>Revisi</th>
                                        <td><?= $model->catatan_revisi ?></td>
                                    </tr> -->

                                </tbody>
                            </table>
                            <hr />
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h4>Data Pembayaran</h4>
                    <div class="card m-b-30">
                        <div class="">
                            <?= $this->render('_data_pembayaran', compact('model')) ?>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h4>Data Pekerjaan</h4>
                    <div class="card m-b-30">
                        <div class="">
                            <?= $this->render('_data_pekerjaan', compact('model')) ?>
                        </div>
                    </div>
                </div>
                <?php if ($model->foto_pengerjaan != null && $model->keterangan_pengerjaan != null) : ?>
                    <div class="col-md-6">
                        <h4>Hasil Pekerjaan</h4>
                        <div class="card m-b-30">
                            <div class="">
                                <?= $this->render('_hasil_pekerjaan', compact('model')) ?>
                            </div>
                        </div>
                    </div>
                <?php endif ?>


                <div class="col-12 text-center mx-auto">
                    <?php
                    // if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && ($model->bukti_dp == null || $model->revisi_pembayaran_dp != null)) {
                    //     echo Html::a('Bayar DP', ['bayar-dp', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white']);
                    // }

                    // if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN && $model->bukti_pembayaran == null) {
                    //     echo Html::a('Bayar Total', ['bayar-total', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white mr-2']);
                    // }
                    // elseif ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN && $model->revisi_pembayaran != null && $model->bukti_pembayaran != null) {
                    //     echo Html::a('Bayar Total', ['bayar-total', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white mr-2']);
                    // }
                    // if ($model->status == \app\models\PekerjaanSameday::STATUS_DIAJUKAN && $model->catatan_revisi == null) {
                    //     echo Html::a('Revisi', ['form-revisi', 'id' => $model->kode_unik], ['class' => 'btn btn-warning']);
                    // }
                    // if ($model->status == \app\models\PekerjaanSameday::STATUS_SELESAI) {
                    //     echo Html::a('Laporan Pekerjaan', ['laporan-pekerjaan', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white']);
                    // }
                    if ($model->status > \app\models\PekerjaanSameday::STATUS_PELENGKAPAN_DATA && $model->status < \app\models\PekerjaanSameday::STATUS_SELESAI) {
                        echo Html::a('Batalkan Layanan', ['batal-layanan', 'id' => $model->kode_unik], ['class' => 'btn btn-danger text-white']);
                    }
                    if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN && $model->revisi_pembayaran != null) {
                        echo Html::a('Bayar Akhir', ['bayar-total', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white ml-2']);
                    }
                    if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->revisi_pembayaran_dp != null) {
                        echo Html::a('Bayar DP', ['bayar-dp', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white ml-2']);
                    }
                    ?>

                    <?php
                    if ($model->status == \app\models\PekerjaanSameday::STATUS_PEMBAYARAN_DP && $model->catatan_revisi == null && $model->bukti_dp == null) { ?>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#revisi-layanan">
                            Revisi Layanan / Bayar DP
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="revisi-layanan" tabindex="-1" role="dialog" aria-labelledby="revisi-layanan" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="revisi-layanan">Apakah Ada Revisi?</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Jika ada revisi, klik tombol revisi. Jika tidak ada maka Anda dapat membayar biaya DP dengan klik tombol bayar akhir. </div>
                                    <div class="modal-footer">
                                        <div class="row" style="width: 100%;">
                                            <div class="col-6">
                                                <?= Html::a('Bayar DP', ['bayar-dp', 'id' => $model->kode_unik], ['class' => 'btn btn-block btn-info text-white']); ?>
                                            </div>
                                            <div class="col-6">
                                                <?= Html::a('Revisi', ['form-revisi', 'id' => $model->kode_unik], ['class' => 'btn btn-block btn-warning']); ?>
                                            </div>
                                        </div>
                                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php } ?>

                    <?php
                    if ($model->status == \app\models\PekerjaanSameday::STATUS_DIAJUKAN && $model->catatan_revisi == null) { ?>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#revisi">
                            Revisi / Bayar Akhir
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="revisi" tabindex="-1" role="dialog" aria-labelledby="revisi" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="revisi">Apakah Ada Revisi?</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Jika ada revisi, klik tombol revisi. Jika tidak ada maka Anda dapat membayar biaya akhir dengan klik tombol bayar akhir. </div>
                                    <div class="modal-footer">
                                        <div class="row" style="width: 100%;">
                                            <div class="col-6">
                                                <?= Html::a('Bayar Total', ['bayar-total', 'id' => $model->kode_unik], ['class' => 'btn btn-block btn-info text-white']); ?>
                                            </div>
                                            <div class="col-6">
                                                <?= Html::a('Revisi', ['form-revisi', 'id' => $model->kode_unik], ['class' => 'btn btn-block btn-warning']); ?>
                                            </div>
                                        </div>
                                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php } ?>
                </div>
            </div>
        </div>
    </div>
</section>
<?php
$this->registerJsFile("@web/homepage/vendor/jquery-3.2.1.min.js", ['position' => \yii\web\View::POS_END]);
?>