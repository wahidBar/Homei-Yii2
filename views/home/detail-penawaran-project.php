<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use dmstr\helpers\Html;
use yii\helpers\Url;
use yii\grid\GridView;
use yii\widgets\DetailView;
use yii\widgets\Pjax;
use app\components\annex\Tabs;
use richardfan\widget\JSRegister;

/**
 * @var yii\web\View $this
 * @var app\models\Proyek $model
 */
$this->registerJsFile("//maps.googleapis.com/maps/api/js?key=AIzaSyAjKSlPBmdJkSO1BY6Qt9gWBlmgVw6KXO4&libraries=places&region=id&language=en");

$this->title = 'Penawaran : ' . $model->kode_penawaran;
$this->registerCss("

.overlay {
    position:absolute;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.4);
}
");
?>
<?php
$setting = \app\models\SiteSetting::find()->all();
?>
<!-- Navigation -->
<section class="navigation">
    <div class="parallax parallax--nav" style="background-image: url(<?= \Yii::$app->request->baseUrl . "/uploads/" . $setting[0]['gambar_header'] ?>);">
        <div class="overlay"></div>
        <div class="container clearfix">
            <div class="row">
                <div class="col-12">
                    <h2>
                        <?= $setting[0]['tagline']; ?>
                    </h2>
                </div>
                <div class="col-12">
                    <p>
                        <?= $setting[0]['tagline2']; ?>
                    </p>
                </div>
                <div class="col-12">
                    <ul class="breadcrumbs ul--inline ul--no-style">
                        <li>
                            <a href="<?= \Yii::$app->request->BaseUrl ?>/home">Home</a>
                        </li>
                        <span>/</span>
                        <li class="active">
                            <a href="#">Detail Penawaran</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Navigation -->
<!-- Contact content -->
<section class="contact-content">
    <div class="container">
        <div class="col-md-12">
            <h2 class="title title-3 title--dark">
                Detail Penawaran
            </h2>
        </div>

        <div class="col-lg-12 col-12 layout-spacing">
            <!-- display success message -->
            <?php if (Yii::$app->session->hasFlash('success')) : ?>
                <div class="alert alert-success alert-dismissable">
                    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                    <p><i class="icon fa fa-check"></i>Saved!</p>
                    <?= Yii::$app->session->getFlash('success') ?>
                </div>
            <?php endif; ?>

            <!-- display error message -->
            <?php if (Yii::$app->session->hasFlash('error')) : ?>
                <div class="alert alert-danger alert-dismissable">
                    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                    <h4><i class="icon fa fa-check"></i>Error!</h4>
                    <?= Yii::$app->session->getFlash('error') ?>
                </div>
            <?php endif; ?>

            <div class="row">
                <div class="col-md-6 col-sm-12">
                    <h4>Informasi Penawaran</h4>
                    <div class="card m-b-30">
                        <div class="card-body">
                            <table class="table table-striped table-bordered">
                                <tbody>
                                    <tr>
                                        <td class="name">
                                            Kode Penawaran
                                        </td>
                                        <td>
                                            <?= $model->kode_penawaran ?>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="name">
                                            Label Design Bangunan
                                        </td>
                                        <td>
                                            <?= $model->isianLanjutan->label ?>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="name">
                                            Estimasi Waktu
                                        </td>
                                        <td>
                                            <?= $model->estimasi_waktu ?> Hari
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="name">
                                            Total Harga Penawaran
                                        </td>
                                        <td>
                                            <?= \app\components\Angka::toReadableHarga($model->total_harga_penawaran) ?>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="name">
                                            Dibuat Pada
                                        </td>
                                        <td>
                                            <?= \Yii::$app->formatter->asDate($model->tgl_transaksi) ?>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <hr />
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 mb-3">
                    <h4>Daftar Material</h4>
                    <div class="card m-b-30">
                        <table class="table table-striped table-bordered">
                            <div class="card-body">
                                <tbody>
                                    <tr>
                                    <td class="name text-center">
                                            Nama Material
                                        </td>
                                        <td class="name text-center">
                                            Kisaran Harga
                                        </td>
                                        <td class="name text-center">
                                            Jumlah
                                        </td>
                                        <!-- <td class="name text-center">
                                            Volume
                                        </td> -->
                                        <td class="name text-center">
                                            Sub Harga
                                        </td>
                                    </tr>
                                    <?php
                                    $penawarans = \app\models\PenawaranDetail::find()->where(['id_penawaran' => $model->id])->all();
                                    // dd($penawarans);
                                    foreach ($penawarans as $tawaran) {
                                    ?>
                                        <tr>
                                            <td class="name">
                                                <?= $tawaran->supplierBarang->nama_barang ?>
                                            </td>
                                            <td class="name text-right">
                                                <?php
                                                $material = \app\models\SupplierBarang::find()->where(['t_supplier_barang.id' => $tawaran->id_material])
                                                    ->joinWith(['satuan'])
                                                    ->select('t_master_satuan.nama')->column();
                                                echo \app\components\Angka::toReadableHarga($tawaran->supplierBarang->harga_proyek) . "/" . $material[0];
                                                ?>
                                            </td>
                                            <td class="name text-right">
                                                <?= $tawaran->jumlah ?>
                                            </td>
                                            <!-- <td class="name text-right">
                                                <?= $tawaran->volume ?>
                                            </td> -->
                                            <td class="name text-right">
                                                <?= \app\components\Angka::toReadableHarga($tawaran->sub_harga) ?>
                                            </td>
                                        </tr>
                                    <?php } ?>
                                    <tr>
                                        <td class="name" colspan="3">
                                            Biaya Tukang
                                        </td>
                                        <td class="name text-right">
                                            <?= \app\components\Angka::toReadableHarga($model->total_harga_penawaran - $model->harga_penawaran) ?>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="name" colspan="3">
                                            Total Harga
                                        </td>
                                        <td class="name text-right">
                                            <?= \app\components\Angka::toReadableHarga($model->total_harga_penawaran) ?>
                                        </td>
                                    </tr>
                                </tbody>
                            </div>
                        </table>
                    </div>
                </div>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-info mx-auto" data-toggle="modal" data-target="#confirm">
                    Pilih Penawaran
                </button>

                <!-- Modal -->
                <div class="modal fade" id="confirm" tabindex="-1" role="dialog" aria-labelledby="akhiri-konsultasi" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Pilih penawaran ini?</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                Apakah Anda yakin memilih penawaran ini?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <?= Html::a('Pilih Penawaran', ['pilih-penawaran', 'id' => $model->kode_unik], ['class' => 'btn btn-info text-white']) ?>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>
<?php
$this->registerJsFile("@web/homepage/vendor/jquery-3.2.1.min.js", ['position' => \yii\web\View::POS_END]);
?>