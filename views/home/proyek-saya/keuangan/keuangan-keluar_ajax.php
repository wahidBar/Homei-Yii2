<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use dmstr\helpers\Html;
use yii\helpers\Url;
use yii\grid\GridView;
use yii\widgets\DetailView;
use yii\widgets\Pjax;
use app\components\annex\Tabs;

/**
 * @var yii\web\View $this
 * @var app\models\ProyekKeuanganKeluar $model
 */

$this->title = 'Proyek Keuangan Keluar : ' . $model->id;
$this->params['breadcrumbs'][] = ['label' => 'Proyek Keuangan Keluar', 'url' => ['index']];
$this->params['breadcrumbs'][] = ['label' => (string)$model->id, 'url' => ['view', 'id' => $model->id]];
$this->params['breadcrumbs'][] = 'View';

$grids = [
    0 => [
        'attribute' => 'no_po',
        'format' => 'text',
    ],
    1 => [
        'attribute' => 'dokumen_po',
        'format' => 'download',
    ],
    2 => [
        'attribute' => 'id_kategori',
        'format' => 'raw',
        'value' => function ($model) {
            return $model->kategori->nama_kategori;
        }
    ],
    3 => [
        'attribute' => 'no_invoice',
        'format' => 'text',
    ],
    4 => [
        'attribute' => 'keterangan',
        'format' => 'ntext',
    ],
    5 => [
        'attribute' => 'tanggal',
        'format' => 'iddate',
    ],
    7 => [
        'attribute' => 'total_jumlah',
        'format' => 'rp',
    ],
    8 => [
        'attribute' => 'vendor',
        'format' => 'text',
    ],
    9 => [
        'attribute' => 'status',
        'format' => 'text',
        'value' => function ($model) {
            return $model->getStatus();
        }
    ],
];

if ($model->tipe == 1)
    $grids[6] = [
        'attribute' => 'total_dibayarkan',
        'format' => 'rp'
    ];
ksort($grids);

?>
<div class="giiant-crud proyek-keuangan-keluar-view">
    <div class="clearfix"></div>

    <!-- flash message -->
    <?php if (\Yii::$app->session->getFlash('deleteError') !== null) : ?>
        <span class="alert alert-info alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span></button>
            <?= \Yii::$app->session->getFlash('deleteError') ?>
        </span>
    <?php endif; ?>

    <div class="row">
        <div class="col-md-12">
            <?php $this->beginBlock('app\models\ProyekKeuanganKeluar'); ?>

            <?= DetailView::widget([
                'model' => $model,
                'options' => ["class" => 'table table-striped table-borderless detail-view'],
                'attributes' => $grids,
            ]); ?>
            <?= \yii\grid\GridView::widget([
                'layout' => '{items}{pager}',
                'dataProvider' => new \yii\data\ActiveDataProvider([
                    'query' => $model->getProyekKeuanganKeluarDetails(),
                    'pagination' => false
                ]),
                'pager'        => [
                    'class'          => \app\components\annex\LinkPager::className(),
                    'firstPageLabel' => 'First',
                    'lastPageLabel'  => 'Last'
                ],
                'columns' => [
                    [
                        'attribute' => 'item',
                        'format' => 'html',
                        'value' => function ($model) {
                            return $model->item . "<br>" . $model->deskripsi;
                        }
                    ],
                    [
                        'attribute' => 'kuantitas',
                        'format' => 'text',
                        'value' => function ($model) {
                            return $model->kuantitas . " " . $model->satuan;
                        }
                    ],
                    [
                        'attribute' => 'harga_satuan',
                        'format' => 'text',
                        'value' => function ($model) {
                            return \Yii::$app->formatter->asRp($model->harga_satuan);
                        }
                    ],
                    [
                        'attribute' => 'jumlah',
                        'format' => 'text',
                        'value' => function ($model) {
                            return \Yii::$app->formatter->asRp($model->jumlah);
                        }
                    ],
                ]
            ]) ?>
            <?php $this->endBlock(); ?>



            <?php $this->beginBlock('ProyekKeuanganKeluarBayars'); ?>
            <?php Pjax::begin(['id' => 'pjax-ProyekKeuanganKeluarBayars', 'enableReplaceState' => false, 'linkSelector' => '#pjax-ProyekKeuanganKeluarBayars ul.pagination a, th a', 'clientOptions' => ['pjax:success' => 'function(){alert("defrindr")}']]) ?>
            <?= '<div class="table-responsive">' .
                \yii\grid\GridView::widget([
                    'layout' => '{pager}<br/>{items}{pager}',
                    'dataProvider' => new \yii\data\ActiveDataProvider([
                        'query' => $model->getProyekKeuanganKeluarBayars()->orderBy(['tanggal' => SORT_ASC]),
                        'pagination' => false
                    ]),
                    'columns' => [
                        [
                            'attribute' => 'tanggal',
                            'format' => 'iddate',
                        ],
                        [
                            'attribute' => 'dibayar',
                            'format' => 'rp',
                        ]
                    ]
                ])
                . '</div>' ?>
            <?php Pjax::end() ?>
            <?php $this->endBlock() ?>


            <?= Tabs::widget(
                [
                    'id' => 'relation-tabs-proyek-keuangan-keluar',
                    'encodeLabels' => false,
                    'items' => array_merge([[
                        'label'   => '<b  class="text-left"># Pembelian dari ' . $model->vendor . ' pada ' . Yii::$app->formatter->asIddate($model->tanggal, false) . ' </b>',
                        'content' => $this->blocks['app\models\ProyekKeuanganKeluar'],
                        'active'  => true,
                    ]], $model->tipe == 1 ? [[
                        'content' => $this->blocks['ProyekKeuanganKeluarBayars'],
                        'label'   => '<small class="text-left">Pembayaran <span class="badge badge-default">' . count($model->getProyekKeuanganKeluarBayars()->asArray()->all()) . '</span></small>',
                        'active'  => false,
                    ]] : []),
                ]
            );
            ?>
        </div>
    </div>
</div>