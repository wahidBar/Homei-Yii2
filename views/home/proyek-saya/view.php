<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use app\components\annex\Alert;
use \yii\helpers\Html;
use app\components\annex\Tabs;
use richardfan\widget\JSRegister;

/**
 * @var yii\web\View $this
 * @var app\models\Proyek $model
 */
$this->registerCssFile("@web/homepage/css/card.css");
\app\assets\MapAsset::register($this);

$this->title = Yii::t("cruds", "Detail Proyek ");
$this->params['breadcrumbs'][] = ['label' => Yii::t("cruds", "Proyek"), 'url' => ['index']];
$this->params['breadcrumbs'][] = ['label' => (string)$model->nama_proyek, 'url' => ['view', 'id' => $model->id]];
$this->params['breadcrumbs'][] = Yii::t("cruds", "Detail");
?>
<style>
    #map_canvas {
        width: 100%;
        height: 70vh;
        margin-bottom: 1rem;
        border-radius: 20px;
        box-shadow: 0 8px 4px 5px #eee;
    }

    .iconproyek {
        margin: auto;
        display: block;
        background-color: #239aDe;
        border-radius: 100%;
        width: 120px;
        height: 120px;
        text-align: center
    }
</style>
<div class="giiant-crud proyek-view">

    <?php if (Yii::$app->user->identity->role_id == 1) : ?>
        <!-- menu buttons -->
        <p class='pull-left'>
            <?= Html::a('<span class="glyphicon glyphicon-pencil"></span> ' . 'Edit', ['update', 'id' => $model->id], ['class' => 'btn btn-info']) ?>
        </p>
        <?php if($model->status != 3 && $model->status != 1) : ?>
        <p class="pull-right">
            <button type="button" class="btn btn-danger btn-block" data-toggle="modal" data-target="#confirm" id="btn-end">
                Pengajuan Selesai
            </button>
        </p>
        <?php endif ?>
        <!-- Modal -->
        <div class="modal fade" id="confirm" tabindex="-1" role="dialog" aria-labelledby="pengajuan-selesai" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Pengajuan Proyek Selesai</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Apakah Anda yakin ingin mengajukan proyek selesai?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                        <a href="<?= \Yii::$app->request->baseUrl . "/proyek/pengajuan-selesai?id=" . $model->id ?>" class="btn btn-warning text-white">Ajukan Selesai</a>
                    </div>
                </div>
            </div>
        </div>
    <?php endif ?>

    <div class="clearfix"></div>

    <!-- flash message -->
    <?php if (\Yii::$app->session->getFlash('deleteError') !== null) : ?>
        <span class="alert alert-info alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span></button>
            <?= \Yii::$app->session->getFlash('deleteError') ?>
        </span>
    <?php endif; ?>
    <?= Alert::widget() ?>
    <div class="row">
        <div class="col-md-12 col-sm-12">
            <div class="card m-b-30">
                <div class="card-body">
                    <?php $this->beginBlock('app\models\Proyek') ?>
                    <div style="margin: 1.5rem;"></div>
                    <div class="row">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">
                                    <div class="cardx cardx-1 text-center">
                                        <div class="cardx__icon"><i class="fa fa-building"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">
                                                <?= $model->nama_proyek ?>
                                            </span>
                                        </div>
                                        <p class="cardx__title text-center"><?= $model->deskripsi_proyek ?></p>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="cardx cardx-2 text-center">
                                        <div class="cardx__icon"><i class="fa fa-dollar"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">Realisasi Dana</span>
                                        </div>
                                        <div class="cardx__title text-center">
                                            <div class="row mx-auto">
                                                <div class="col-6">
                                                    <p class="text-left ml-5">Total Anggaran</p>
                                                </div>
                                                <div class="col-6">
                                                    <p class="text-right mr-5"><?= $model->getTotalAnggaran() ?></p>
                                                </div>
                                                <div class="col-6">
                                                    <p class="text-left ml-5">Total Pengeluaran</p>
                                                </div>
                                                <div class="col-6">
                                                    <p class="text-right mr-5"><?= $model->getTotalPengeluaran() ?></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="cardx cardx-3 text-center">
                                        <div class="cardx__icon"><i class="fa fa-clock-o"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">Sisa Waktu</span>
                                        </div>
                                        <div class="cardx__title text-center">
                                            <div class="row">
                                                <div class="col-12">
                                                    <p class=""><?= $model->getSisaHari() ?> Hari</p>
                                                </div>
                                                <div class="col-12">
                                                    <p class="">
                                                        <?= Yii::$app->formatter->asIddate($model->tanggal_awal_kontrak) ?>
                                                        -
                                                        <?= Yii::$app->formatter->asIddate($model->tanggal_akhir_kontrak) ?>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12 col-12">
                                    <div class="cardx cardx-4 text-center" style="min-height: 120px;">
                                        <div class="cardx__icon mt-3"><i class="fa fa-money"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">Nilai Kontrak</span>
                                        </div>
                                        <div class="cardx__title text-center mt-3">
                                            <div class="row">
                                                <div class="col-12">
                                                    <p class=""><?= \Yii::$app->formatter->asRp($model->nilai_kontrak) ?></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12 col-12">
                                    <div class="cardx cardx-1 text-center" style="min-height: 120px;">
                                        <div class="cardx__icon"><i class="fa fa-bar-charts"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">Deviasi Progress</span>
                                        </div>
                                        <div class="cardx__title text-center">
                                            <div class="row mx-auto">
                                                <div class="col-8">
                                                    <p class="text-left ml-4">Week Period</p>
                                                </div>
                                                <div class="col-4">
                                                    <p class="text-left"><?= round($progress_minggu_ini['data'], 2) ?> %</p>
                                                </div>
                                                <div class="col-8">
                                                    <p class="text-left ml-4">Deviasi</p>
                                                </div>
                                                <div class="col-4">
                                                    <p class="text-left"><?= round($progress_minggu_ini['deviasi'], 2) ?> %</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-12 col-12">
                                    <div class="cardx cardx-5 text-center" style="min-height: 120px;">
                                        <div class="cardx__icon mt-3"><i class="fa fa-hourglass-half"></i>
                                            <span class="font-weight-bold" style="font-size: 1rem;">Realisasi Proyek</span>
                                        </div>
                                        <div class="cardx__title text-center mt-3">
                                            <div class="row">
                                                <div class="col-12">
                                                    <p class=""><?= $model->getRealisasiProyek() ?></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-12 mt-4">
                                    <div id="chart" style="width: calc(100% / 1 - 15px);">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <?php $this->endBlock() ?>
                    <?php $this->beginBlock('Map') ?>

                    <div id="map_canvas"></div>
                    <?php $this->endBlock() ?>

                    <?= Tabs::widget(
                        [
                            'id' => 'relation-tabs',
                            'encodeLabels' => false,
                            'linkOptions' => [
                                'class' => 'nav-link',
                                'style' => '
                                border: groove;
                                border-color: #239ade;
                                border-radius:0;
                                border-top: 10px;
                                border-left: 0px;
                                border-right: 0px;
                                ',
                            ],
                            'items' => [
                                [
                                    'label'   => '<b class="">Detail Proyek</b>',
                                    'content' => $this->blocks['app\models\Proyek'],
                                    'active'  => true,
                                ],
                                [
                                    'content' => $this->blocks['Map'],
                                    'label'   => 'Lokasi Proyek',
                                    'active'  => false,
                                ],
                            ]
                        ]
                    );
                    ?>
                    <hr />
                    <div class="col-md-12">
                        <?= Html::a('Keuangan', ['/keuangan/view', 'id' => $model->id], ['class' => 'btn btn-primary btn-block']) ?>
                    </div>
                    <div class="col-12 mt-5">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <tr>
                                    <th colspan="2"><?= Yii::t("cruds", "Data Pembayaran") ?></th>
                                </tr>
                                <tr>
                                    <th><?= $model->getAttributeLabel('total_pembayaran') ?></th>
                                    <td>
                                        <?php
                                        $kurang = $model->nilai_kontrak - $model->total_pembayaran;
                                        // echo $kurang;
                                        echo Yii::$app->formatter->asRp($model->total_pembayaran) . " (" . Yii::t("cruds", "Sisa") . " " . Yii::$app->formatter->asRp($kurang) . ")" ?></td>
                                </tr>
                                <tr>
                                    <th colspan="2"><?= Yii::t("cruds", "Status Proyek") ?></th>
                                </tr>
                                <tr>
                                    <th><?= Yii::t("cruds", "Status Proyek") ?></th>
                                    <td><?= $model->getStatus() ?></td>
                                </tr>
                                <?php if($model->catatan_revisi != null): ?>
                                <tr>
                                    <th colspan="2"><?= Yii::t("cruds", "Data Revisi") ?></th>
                                </tr>
                                <tr>
                                    <th><?= $model->getAttributeLabel('catatan_revisi') ?></th>
                                    <td><?= $model->catatan_revisi ?></td>
                                </tr>
                                <?php endif ?>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <?php $this->beginBlock('Cctv') ?>
    <div class="row">
        <div class="col-md-6 col-sm-12 mb-3">
            <h4>CCTV</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_cctv', compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?php $this->beginBlock('Galeri') ?>

    <div class="row">
        <div class="col-md-6 col-sm-12 mb-3">
            <h4>Dokumen & Desain</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_dokumen', compact('model')) ?>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-12 mb-3">
            <h4>Galeri</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_galeri', compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?php $this->beginBlock('Progress') ?>
    <div class="row">
        <div class="col-md-12">
            <h4>Progress</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render("_view/_progress", compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?php $this->beginBlock('Termin') ?>
    <div class="row">
        <div class="col-12 col-sm-12 mb-3">
            <h4>Termin</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_termin', compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?php $this->beginBlock('TargetProgress') ?>
    <div class="row">
        <div class="col-12 col-sm-12 mb-3">
            <h4>Target Progress</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_target-progress', compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?php $this->beginBlock('Anggota') ?>
    <div class="row">
        <div class="col-12 col-sm-12 mb-3">
            <h4>Anggota</h4>
            <div class="card m-b-30">
                <div class="card-body">
                    <?= $this->render('_view/_anggota', compact('model')) ?>
                </div>
            </div>
        </div>
    </div>
    <?php $this->endBlock() ?>

    <?= Tabs::widget(
        [
            'id' => 'second-relation-tabs',
            'encodeLabels' => false,
            'items' => [
                [
                    'label'   => '<b class="">Cctv</b>',
                    'content' => $this->blocks['Cctv'],
                    'active'  => true,
                ],
                [
                    'label'   => '<b class="">File</b>',
                    'content' => $this->blocks['Galeri'],
                    'active'  => false,
                ],
                [
                    'label'   => '<b class="">Progress</b>',
                    'content' => $this->blocks['Progress'],
                    'active'  => false,
                ],
                [
                    'label'   => '<b class="">Termin</b>',
                    'content' => $this->blocks['Termin'],
                    'active'  => false,
                ],
                [
                    'label'   => '<b class="">Target Progress</b>',
                    'content' => $this->blocks['TargetProgress'],
                    'active'  => false,
                ],
                [
                    'label'   => '<b class="">Anggota</b>',
                    'content' => $this->blocks['Anggota'],
                    'active'  => false,
                ],
            ]
        ]
    );
    ?>

</div>


<?php
// $this->registerJsFile("@web/homepage/charts/apexcharts.js");
?>
<?php JSRegister::begin(); ?>
<script>
    var options = {
        chart: {
            height: 452,
            width: "100%",
            toolbar: {
                show: !1
            },
            type: "area",
            toolbar: {
                show: true,
                tools: {
                    download: true,
                    selection: true,
                    zoom: true,
                    zoomin: true,
                    zoomout: true,
                    pan: true,
                    reset: true
                },
                autoSelected: "zoom"
            },
            zoom: {
                enabled: true,
                type: 'x',
                autoScaleYaxis: true,
                zoomedArea: {
                    fill: {
                        color: '#90CAF9',
                        opacity: 0.4
                    },
                    stroke: {
                        color: '#0D47A1',
                        opacity: 0.4,
                        width: 1
                    }
                }
            }
        },
        stroke: {
            curve: "straight",
            width: [4, 4]
        },
        grid: {
            borderColor: "#d5d5d5"
        },
        legend: {
            show: !1
        },
        colors: ['#b84644', '#45A387'],
        fill: {
            type: "solid",
        },
        markers: {
            size: 0,
            hover: {
                size: 5
            }
        },
        fill: {
            type: 'gradient',
            gradient: {
                opacityFrom: 0.6,
                opacityTo: 0.1,
            }
        },
        legend: {
            position: 'bottom',
            horizontalAlign: 'center'
        },
        xaxis: {
            type: 'datetime',
            labels: {
                style: {
                    colors: "#000"
                }
            },
            axisTicks: {
                show: !1,
            },
            categories: <?= $daftar_tanggal  ?>,
            axisBorder: {
                show: !1
            },
            tickPlacement: "on"
        },
        yaxis: {
            tickAmount: 5,
            max: 100,
            labels: {
                style: {
                    color: "#000"
                },
            },
            title: {
                text: '%',
            },
        },
        tooltip: {
            x: {
                format: 'dd/MM/yy'
            },
        },
        series: [{
            name: 'Target Progress',
            data: <?= $target_perminggu ?>
        }, {
            name: 'Progress',
            data: <?= $progress_perminggu ?>
        }],
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
</script>
<?php JSRegister::end(); ?>

<?php

$lat = ($model->latitude_proyek) ? $model->latitude_proyek : 0;
$long = ($model->longitude_proyek) ? $model->longitude_proyek : 0;

$js = <<<JS
$(function() {
    let lat = $lat,
    lng = $long,
    latlng = new google.maps.LatLng(lat, lng);
    let mapOptions = {
        center: new google.maps.LatLng(lat, lng),
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        panControl: true,
        panControlOptions: {
            position: google.maps.ControlPosition.TOP_RIGHT
        },
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.LARGE,
            position: google.maps.ControlPosition.TOP_left
        }
    },
    map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions),
    marker = new google.maps.Marker({
        position: latlng,
        map: map,
    });
});

$(function(){
    
	$('.modalButton').click(function (){
        console.log($(this).attr('value'));
		$('#modal').modal('show')
			.find('#modalContent')
			.load($(this).attr('value'));
	});
})
JS;

$this->registerJs($js);
