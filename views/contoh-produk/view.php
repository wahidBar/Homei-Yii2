<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use dmstr\helpers\Html;
use yii\helpers\Url;
use yii\grid\GridView;
use yii\widgets\DetailView;
use yii\widgets\Pjax;
use app\components\annex\Tabs;
use richardfan\widget\JSRegister;

$this->registerCssFile("@web/homepage/css/image-map.css");
/**
 * @var yii\web\View $this
 * @var app\models\ContohProduk $model
 */

$this->title = 'Contoh Produk : ' . $model->id;
$this->params['breadcrumbs'][] = ['label' => 'Contoh Produk', 'url' => ['index']];
$this->params['breadcrumbs'][] = ['label' => (string)$model->id, 'url' => ['view', 'id' => $model->id]];
$this->params['breadcrumbs'][] = 'View';
?>
<?= $this->render('../layouts/navigation-setting') ?>

<div class="giiant-crud contoh-produk-view">

    
    <div class="row">
        <div class="col-md-12">
            <div class="card m-b-30">
                <div class="card-body">
                    <!-- menu buttons -->
                    <p class='pull-left'>
                        <?= Html::a('<span class="glyphicon glyphicon-pencil"></span> ' . 'Edit', ['update', 'id' => $model->id], ['class' => 'btn btn-info']) ?>
                    </p>
                    <p class="pull-right">
                        <?= Html::a('<span class="glyphicon glyphicon-list"></span> ' . 'Daftar Contoh Produk', ['index'], ['class' => 'btn btn-default']) ?>
                    </p>
                
                    <div class="clearfix"></div>
                
                    <!-- flash message -->
                    <?php if (\Yii::$app->session->getFlash('deleteError') !== null) : ?>
                        <span class="alert alert-info alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span></button>
                            <?= \Yii::$app->session->getFlash('deleteError') ?>
                        </span>
                    <?php endif; ?>
                    <div class="col-12 mb-4">
                        <div id="image-map">
                            <img style="width: 100%;height: auto;" src="<?= \Yii::$app->request->baseUrl . "/uploads/" . $cproduk->gambar ?>">
                            <?php foreach ($dproduks as $produk) { ?>
                                <div class="<?= (($produk->y_pos <= 50) ? "pin" : (($produk->y_pos > 50) ? "pin pin-down" : "pin")) ?>" data-xpos="<?= $produk->x_pos ?>" data-ypos="<?= $produk->y_pos ?>">
                                    <div class="col-12 image-content" style="background-image: url(<?= \Yii::$app->request->baseUrl . "/uploads/" . $produk->supplierBarang->gambar ?>);">
                                    </div>
                                    <div class="text-center">
                                        <h2><?= $produk->supplierBarang->nama_barang ?></h2>
                                        <p><?= \app\components\Angka::toReadableHarga($produk->supplierBarang->harga_ritel) ?></p>
                                    </div>
                                </div>
                            <?php } ?>
                        </div>
                    </div>
                    <?php $this->beginBlock('app\models\ContohProduk'); ?>

                    <?= DetailView::widget([
                        'model' => $model,
                        'attributes' => [
                            [
                                'attribute' => 'gambar',
                                'format' => 'myImage',
                            ],
                        ],
                    ]); ?>

                    <hr />
                    <?php $this->endBlock(); ?>



                    <?php $this->beginBlock('DetailContohProduks'); ?>
                    <div style='position: relative'>
                        <div style='position:absolute; right: 0px; top: 0px;'>
                            <?= Html::a(
                                '<span class="glyphicon glyphicon-list"></span> ' . 'Semua Data' . ' Detail Contoh Produks',
                                ['detail-contoh-produk/index'],
                                ['class' => 'btn text-muted btn-xs']
                            ) ?>
                            <?= Html::a(
                                '<span class="glyphicon glyphicon-plus"></span> ' . 'Tambah Baru' . ' Detail Contoh Produk',
                                ['detail-contoh-produk/create', 'id' => $model->id],
                                ['class' => 'btn btn-success btn-xs']
                            ); ?>
                        </div>
                    </div><?php Pjax::begin(['id' => 'pjax-DetailContohProduks', 'enableReplaceState' => false, 'linkSelector' => '#pjax-DetailContohProduks ul.pagination a, th a', 'clientOptions' => ['pjax:success' => 'function(){alert("defrindr")}']]) ?>
                    <?= '<div class="table-responsive">'
                        .                     \yii\grid\GridView::widget([
                            'layout' => '{summary}{pager}<br/>{items}{pager}',
                            'dataProvider' => new \yii\data\ActiveDataProvider([
                                'query' => $model->getDetailContohProduks(),
                                'pagination' => [
                                    'pageSize' => 20,
                                    'pageParam' => 'page-detailcontohproduks',
                                ]
                            ]),
                            'pager'        => [
                                'class'          => \app\components\annex\LinkPager::className(),
                                'firstPageLabel' => 'First',
                                'lastPageLabel'  => 'Last'
                            ],
                            'columns' => [
                                [
                                    'class'      => 'yii\grid\ActionColumn',
                                    'template'   => '{update} {delete}',
                                    'contentOptions' => ['nowrap' => 'nowrap'],
                                    'urlCreator' => function ($action, $model, $key, $index) {
                                        // using the column name as key, not mapping to 'id' like the standard generator
                                        $params = is_array($key) ? $key : [$model->primaryKey()[0] => (string) $key];
                                        $params[0] = 'detail-contoh-produk' . '/' . $action;
                                        $params['DetailContohProduk'] = ['id_contoh_produk' => $model->id_contoh_produk];
                                        return $params;
                                    },
                                    'buttons'    => [
                                        'update' => function ($url, $model, $key) {
                                            return Html::a("<i class='fa fa-pencil'></i>", $url, ["class" => "mr-1 mb-1 btn btn-warning", "title" => "Edit Data"]);
                                        },
                                        'delete' => function ($url, $model, $key) {
                                            return Html::a("<i class='fa fa-trash'></i>", $url, [
                                                "class" => "mr-1 mb-1 btn btn-danger",
                                                "title" => "Hapus Data",
                                                'method' => 'post',
                                                "data-confirm" => "Apakah Anda yakin ingin menghapus data ini ?",
                                            ]);
                                        },
                                    ],
                                    'controller' => 'detail-contoh-produk'
                                ],
                                [
                                    'attribute' => 'x_pos',
                                    'format' => 'text',
                                ],
                                [
                                    'attribute' => 'y_pos',
                                    'format' => 'text',
                                ],
                                [
                                    'class' => yii\grid\DataColumn::className(),
                                    'attribute' => 'gambar',
                                    'value' => function ($model) {
                                        if ($rel = $model->supplierBarang) {
                                            return $rel->gambar;
                                        } else {
                                            return '-';
                                        }
                                    },
                                    'format' => 'myImage',
                                ],
                                [
                                    'class' => yii\grid\DataColumn::className(),
                                    'attribute' => 'nama_barang',
                                    'value' => function ($model) {
                                        if ($rel = $model->supplierBarang) {
                                            return $rel->nama_barang;
                                        } else {
                                            return '';
                                        }
                                    },
                                    'format' => 'raw',
                                ],
                                [
                                    'attribute' => 'created_at',
                                    'format' => 'iddate',
                                ],
                                [
                                    'attribute' => 'updated_at',
                                    'format' => 'iddate',
                                ],
                            ]
                        ])
                        . '</div>' ?>
                    <?php Pjax::end() ?>
                    <?php $this->endBlock() ?>


                    <?= Tabs::widget(
                        [
                            'id' => 'relation-tabs',
                            'encodeLabels' => false,
                            'items' => [
                                [
                                    'label'   => '<b class=""># ' . $model->id . '</b>',
                                    'content' => $this->blocks['app\models\ContohProduk'],
                                    'active'  => false,
                                ],                        [
                                    'content' => $this->blocks['DetailContohProduks'],
                                    'label'   => '<small>Detail Contoh Produks <span class="badge badge-default">' . count($model->getDetailContohProduks()->asArray()->all()) . '</span></small>',
                                    'active'  => true,
                                ],
                            ]
                        ]
                    );
                    ?>
                </div>
            </div>
        </div>
    </div>
</div>
<?php JSRegister::begin(); ?>
<script>
    $(document).ready(function() {
        // set the image-map width and height to match the img size
        $('#image-map').css({
            'width': $('#image-map img').width(),
            'height': $('#image-map img').height()
        })
        //tooltip direction
        var tooltipDirection;

        for (i = 0; i < $(".pin").length; i++) {
            // set tooltip direction type - up or down             
            if ($(".pin").eq(i).hasClass('pin-down')) {
                tooltipDirection = 'tooltip2-down';
            } else {
                tooltipDirection = 'tooltip2-up';
            }

            // append the tooltip
            $("#image-map").append("<div style='left:" + $(".pin").eq(i).data('xpos') + "%;top:" + $(".pin").eq(i).data('ypos') + "%' class='" + tooltipDirection + "'>\
                                        <div class='tooltip2'>" + $(".pin").eq(i).html() + "</div>\
                                </div>");
        }

        // show/hide the tooltip
        $('.tooltip2-up, .tooltip2-down').mouseenter(function() {
            $(this).children('.tooltip2').fadeIn(100);
        }).mouseleave(function() {
            $(this).children('.tooltip2').fadeOut(100);
        })
    });
</script>
<?php JSRegister::end(); ?>