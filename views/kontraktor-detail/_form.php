<?php

/**
 * Autogenerated From GII
 * modified by Defri Indra M
 * 2021
 */

use yii\helpers\Html;
use app\components\annex\ActiveForm;
use \app\components\annex\Tabs;
use app\models\Kontraktor;
use app\models\User;
use yii\helpers\Url;

/**
 * @var yii\web\View $this
 * @var app\models\KontraktorDetail $model
 * @var app\components\annex\ActiveForm $form
 */

if ($model->id_kontraktor) {
    $list_kontraktor = Kontraktor::findOne(['id' => $model->id_kontraktor]);
    if ($list_kontraktor) {
        $list_user = User::find()->where(['not in', 'id', $list_kontraktor->getKontraktorDetails()->select('id_user')])->all();
    } else {
        $list_user = User::find()->all();
    }
} else {
    $list_user = User::find()->all();
}
?>

<?php $form = ActiveForm::begin([
    'id' => 'KontraktorDetail',
    'layout' => 'horizontal',
    'enableClientValidation' => true,
    'errorSummaryCssClass' => 'error-summary alert alert-error'
]);
?>
<?php echo $form->errorSummary($model); ?>

<div class="clearfix"></div>
<div class="d-flex  flex-wrap">

    <?= $form->field($model, 'id_kontraktor', ['template' => '{input}'])->hiddenInput()->label(false); ?>
    <?= $form->field($model, 'id_user', \app\components\Constant::COLUMN(1))->widget(\kartik\select2\Select2::classname(), [
        'name' => 'class_name',
        'model' => $model,
        'attribute' => 'id_user',
        'data' => \yii\helpers\ArrayHelper::map($list_user, 'id', 'name'),
        'options' => [
            // 'placeholder' => "Masukkan minimal 3 huruf",
            'multiple' => false,
            'disabled' => (isset($relAttributes) && isset($relAttributes['id_user'])),
        ],
        // 'pluginOptions' => [
        //     'allowClear' => true,
        //     'minimumInputLength' => 3,
        //     'ajax' => [
        //         'url' => Url::to(['site/api/data/user']),
        //         'dataType' => 'json',
        //         'delay' => 250,
        //         'data' => new \yii\web\JsExpression('function(params) { return {q:params.term, page: params.page}; }'),
        //         'processResults' => new \yii\web\JsExpression($resultsJs),
        //         'cache' => true
        //     ],
        //     'escapeMarkup' => new \yii\web\JsExpression('function (markup) { return markup; }'),
        //     'templateResult' => new \yii\web\JsExpression('formatRepo'),
        //     'templateSelection' => new \yii\web\JsExpression('formatRepoSelection'),
        // ],
    ]); ?>
    <div class="clearfix"></div>
</div>
<hr />
<div class="row">
    <div class="col-md-offset-3 col-md-10">
        <?= Html::submitButton('<i class="fa fa-save"></i> Simpan', ['class' => 'btn btn-success']); ?>
        <?= Html::a('<i class="fa fa-chevron-left"></i> Kembali', ['/kontraktor/view', $model->id_kontraktor], ['class' => 'btn btn-default']) ?>
    </div>
</div>
<?php ActiveForm::end(); ?>